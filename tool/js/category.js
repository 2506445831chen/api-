var goods = [{
    "categoryType": 101,
    "productInfos": [{
        "categoryType": 101,
        "productId": "0bebba5d711944bdaeee082246aa40e3",
        "createTime": "Tue Feb 26 17:15:55 CST 2019",
        "productStock": 0,
        "productStatus": null,
        "productIcon": "danta.jpg",
        "updateTime": "Wed Feb 27 00:17:20 CST 2019",
        "productName": "蛋挞",
        "productPrice": 2.0,
        "productDescription": "甜又脆"
    }],
    "categoryName": "饭后甜点",
    "categoryId": "1f1dd7c00788480c9c7d2c05e26453e9"
}, {
    "categoryType": 104,
    "productInfos": [{
        "categoryType": 104,
        "productId": "51ef0af14a5948228b8734c22633fca8",
        "createTime": "Mon Feb 25 18:03:40 CST 2019",
        "productStock": 2,
        "productStatus": null,
        "productIcon": "lamian1.jpg",
        "updateTime": "Wed Feb 27 00:17:43 CST 2019",
        "productName": "扬州拉面",
        "productPrice": 12.0,
        "productDescription": "细而长"
    }, {
        "categoryType": 104,
        "productId": "6921fc4b8e4f495eb8f4355e664c441f",
        "createTime": "Tue Feb 26 18:39:11 CST 2019",
        "productStock": 0,
        "productStatus": null,
        "productIcon": "lamian2.jpg",
        "updateTime": "Wed Feb 27 00:17:32 CST 2019",
        "productName": "打撸面",
        "productPrice": 5.0,
        "productDescription": "便宜又实惠"
    }],
    "categoryName": "面条",
    "categoryId": "8588049f4c77424ab481c3b6a9bc47ff"
}, {
    "categoryType": 99,
    "productInfos": [{
        "categoryType": 99,
        "productId": "2413b7cb20f64f0a9370a46ddd5f31b0",
        "createTime": "Tue Feb 26 18:40:09 CST 2019",
        "productStock": 0,
        "productStatus": null,
        "productIcon": "mianbao.jpg",
        "updateTime": "Wed Feb 27 00:17:08 CST 2019",
        "productName": "红旗牌面包",
        "productPrice": 4.0,
        "productDescription": "软而又有味道"
    }],
    "categoryName": "面包",
    "categoryId": "b34ef5acc11b4ed186d8da9aee7ace28"
}, {
    "categoryType": 97,
    "productInfos": [{
        "categoryType": 97,
        "productId": "14141b4a77ff41be82ff8230e66f7c10",
        "createTime": "Mon Feb 25 18:23:00 CST 2019",
        "productStock": 121,
        "productStatus": null,
        "productIcon": "huolongguo.jpg",
        "updateTime": "Wed Feb 27 00:16:56 CST 2019",
        "productName": "火龙果",
        "productPrice": 12.0,
        "productDescription": "鲜甜可口"
    }, {
        "categoryType": 97,
        "productId": "41b30df6cfc1494b9703e9adfcc9a05f",
        "createTime": "Mon Feb 25 18:17:17 CST 2019",
        "productStock": 12,
        "productStatus": null,
        "productIcon": "pingguo.jpg",
        "updateTime": "Wed Feb 27 00:16:46 CST 2019",
        "productName": "苹果",
        "productPrice": 6.0,
        "productDescription": "水大而且红润"
    }, {
        "categoryType": 97,
        "productId": "874155e43219434eae2a431da375e847",
        "createTime": "Mon Feb 25 18:22:42 CST 2019",
        "productStock": 1,
        "productStatus": null,
        "productIcon": "banana.jpg",
        "updateTime": "Wed Feb 27 00:16:30 CST 2019",
        "productName": "香蕉",
        "productPrice": 5.0,
        "productDescription": "软而富含大量维生素"
    }],
    "categoryName": "水果",
    "categoryId": "bf7f85b5dd824f36ac57cbc3e256257e"
}, {
    "categoryType": 96,
    "productInfos": [{
        "categoryType": 96,
        "productId": "36390dc2b75f49308ae16c27216a4528",
        "createTime": "Mon Feb 25 18:04:43 CST 2019",
        "productStock": 12,
        "productStatus": null,
        "productIcon": "huanggua.jpg",
        "updateTime": "Wed Feb 27 00:15:37 CST 2019",
        "productName": "黄瓜",
        "productPrice": 12.0,
        "productDescription": "脆"
    }, {
        "categoryType": 96,
        "productId": "b57d1f2a496048b98e82c62e183c282a",
        "createTime": "Mon Feb 25 18:05:09 CST 2019",
        "productStock": 20,
        "productStatus": null,
        "productIcon": "baicai.jpg",
        "updateTime": "Wed Feb 27 00:16:05 CST 2019",
        "productName": "白菜",
        "productPrice": 12.0,
        "productDescription": "很脆很好吃"
    }],
    "categoryName": "菜品",
    "categoryId": "efa4e69843544fd9ad33918ee6ba0548"
}];
var order = [{
    "categoryType": 96,
    "productId": "36390dc2b75f49308ae16c27216a4528",
    "createTime": "Mon Feb 25 18:04:43 CST 2019",
    "productStock": 12,
    "productStatus": null,
    "productIcon": "huanggua.jpg",
    "updateTime": "Wed Feb 27 00:15:37 CST 2019",
    "productName": "黄瓜",
    "productPrice": 12,
    "productDescription": "脆",
    "count": ''
}, {
    "categoryType": 96,
    "productId": "b57d1f2a496048b98e82c62e183c282a",
    "createTime": "Mon Feb 25 18:05:09 CST 2019",
    "productStock": 20,
    "productStatus": null,
    "productIcon": "baicai.jpg",
    "updateTime": "Wed Feb 27 00:16:05 CST 2019",
    "productName": "白菜",
    "productPrice": 12,
    "productDescription": "很脆很好吃"
}, {
    "categoryType": 97,
    "productId": "874155e43219434eae2a431da375e847",
    "createTime": "Mon Feb 25 18:22:42 CST 2019",
    "productStock": 1,
    "productStatus": null,
    "productIcon": "banana.jpg",
    "updateTime": "Wed Feb 27 00:16:30 CST 2019",
    "productName": "香蕉",
    "productPrice": 5,
    "productDescription": "软而富含大量维生素",
    "count": ''
}, {
    "categoryType": 97,
    "productId": "41b30df6cfc1494b9703e9adfcc9a05f",
    "createTime": "Mon Feb 25 18:17:17 CST 2019",
    "productStock": 12,
    "productStatus": null,
    "productIcon": "pingguo.jpg",
    "updateTime": "Wed Feb 27 00:16:46 CST 2019",
    "productName": "苹果",
    "productPrice": 6,
    "productDescription": "水大而且红润"
}, {
    "categoryType": 97,
    "productId": "14141b4a77ff41be82ff8230e66f7c10",
    "createTime": "Mon Feb 25 18:23:00 CST 2019",
    "productStock": 121,
    "productStatus": null,
    "productIcon": "huolongguo.jpg",
    "updateTime": "Wed Feb 27 00:16:56 CST 2019",
    "productName": "火龙果",
    "productPrice": 12,
    "productDescription": "鲜甜可口"
}, {
    "categoryType": 99,
    "productId": "2413b7cb20f64f0a9370a46ddd5f31b0",
    "createTime": "Tue Feb 26 18:40:09 CST 2019",
    "productStock": 0,
    "productStatus": null,
    "productIcon": "mianbao.jpg",
    "updateTime": "Wed Feb 27 00:17:08 CST 2019",
    "productName": "红旗牌面包",
    "productPrice": 4,
    "productDescription": "软而又有味道",
    "count": ''
}, {
    "categoryType": 101,
    "productId": "0bebba5d711944bdaeee082246aa40e3",
    "createTime": "Tue Feb 26 17:15:55 CST 2019",
    "productStock": 0,
    "productStatus": null,
    "productIcon": "danta.jpg",
    "updateTime": "Wed Feb 27 00:17:20 CST 2019",
    "productName": "蛋挞",
    "productPrice": 2,
    "productDescription": "甜又脆"
}, {
    "categoryType": 104,
    "productId": "51ef0af14a5948228b8734c22633fca8",
    "createTime": "Mon Feb 25 18:03:40 CST 2019",
    "productStock": 2,
    "productStatus": null,
    "productIcon": "lamian1.jpg",
    "updateTime": "Wed Feb 27 00:17:43 CST 2019",
    "productName": "扬州拉面",
    "productPrice": 12,
    "productDescription": "细而长"
}, {
    "categoryType": 104,
    "productId": "6921fc4b8e4f495eb8f4355e664c441f",
    "createTime": "Tue Feb 26 18:39:11 CST 2019",
    "productStock": 0,
    "productStatus": null,
    "productIcon": "lamian2.jpg",
    "updateTime": "Wed Feb 27 00:17:32 CST 2019",
    "productName": "打撸面",
    "productPrice": 5,
    "productDescription": "便宜又实惠",
    "count": ''
}];
var allCount = 0;
var totalPrice = 0;
var total = 0;
var image = '../img/';
localdata();

function localdata() {
    goods[0].active = 'active';
        // getOrder();
    data();
    goodsData();
    footerNumber();
}


//获取所点商品
// getData();

function getData() {
    order = localStorage.getItem('order');

    order = JSON.parse(order);
    allCount = localStorage.getItem('allCount');
    total = localStorage.getItem('total');
    ordernumber();
    computer();
}



//左边页面的铺设
function data() {
    $('.left .li').remove();
    for (var i = 0; i < goods.length; i++) {
        $('.left').append(`
                <a class="li ${goods[i].active}" href="#${goods[i].categoryId}" onclick="categoryNameactive(${i})">
                   ${goods[i].categoryName}
                </a>
    `);
        goods[i].active = '';
    }
}

//分类动画
function categoryNameactive(i) {
    goods[i].active = 'active';
    data();
};

//商品列表
function goodsData() {
    // $('.right').remove();
    // $('.Part').append(`<div class="right"></div>`);
    for (var i = 0; i < goods.length; i++) {
        var product = goods[i].productInfos;
        $('.right').append(`
                <a id="${goods[i].categoryId}" style="display: block;" class="smalltitle">${goods[i].categoryName}</a>
    `);
        for (var index = 0; index < product.length; index++) {
            var num = 0;
            var id = product[index].productId;
            for (var a = 0; a < order.length; a++) {
                if (order[a].productId == id) {
                    if (order[a].count) {
                        num = order[a].count;
                    } else {
                        num = 0
                    }
                }
            }
            ;
            $('.right').append(`
                 <div class="goods">
                        <a href="#" style="display: block; width: 11.36rem;">
                            <div class='image' onclick="toDetails('${product[index].productId}')">
                                <image src='${image}${product[index].productIcon}'></image>
                            </div>
                            <div class="information">
        
                                <div class='h1'>${product[index].productName}</div>
                                <div class='p'>${product[index].productDescription}</div>
                                <div class='price'>  <span class="i18n" name="Symbol"></span>
                                    <div class='span'>${product[index].productPrice}</div>
                                </div>
                            </div>
                        </a>
                        <div class='iconfontbox'>
                            <div class="reduceshow ${product[index].productId}">
                            <div class="iconfont icon-jianhao" onclick='reduceCar("${product[index].productId}")'></div>
 
                             <div class='word'>${num}</div>
      
                            </div>
                            <div class="iconfont icon-jiahao" onclick='addCar("${product[index].productId}")'></div>
                        </div>
                    </div>
         `)
        }
    }
    execI18n();
}

//数据的更改
function ordernumber() {
    $('.reduceshow div').remove();
    for (var i = 0; i < goods.length; i++) {
        var product = goods[i].productInfos;
        for (var index = 0; index < product.length; index++) {
            var num = 0;
            var id = product[index].productId;
            for (var a = 0; a < order.length; a++) {
                if (order[a].productId == id) {
                    if (order[a].count) {
                        num = order[a].count;
                    } else {
                        num = 0
                    }
                }
            }
            ;
            $(`.${product[index].productId}`).append(`
     <div class="iconfont icon-jianhao" onclick='reduceCar("${product[index].productId}")'></div>
 
      <div class='word'>${num}</div>
    `)
        }
    }
}

//底部数据
function footerNumber() {
    if(allCount==0){
        $('.count').attr('style','display:none');
        $('.price_number').html(`${totalPrice}`)
    }else {
        $('.count').attr('style','');
        $('.count').html(`${allCount}`);
        $('.price_number').html(`${totalPrice}`)
    }
}

//出现清空页
function showCar() {
    if(allCount==0){
    }else {
        $('.bottomCar').attr('style', '');
        $('.screen').attr('style', '');
        bottomCar()
    }
}

function bottomCar() {
    console.log(order);
    $('.bottomCar .licar').remove();
    for (var i = 0; i < order.length; i++) {
        if (order[i].count) {
            $('.boxlicar').append(`
      <div class="licar">
        <div class="name">${order[i].productName}</div>
        <div class="span_center">
        <span class="i18n" name="Symbol">￥</span>
        <span>${order[i].productPrice} </span>
        </div>
        <div class='bottom_icon'>
            <div class="reduceshow ${order[i].productId}">
                <div class="iconfont icon-jianhao" onclick='reduceCar("${order[i].productId}")'></div>
                <div class='word'>${order[i].count}</div>
            </div>
            <div class="iconfont icon-jiahao" onclick='addCar("${order[i].productId}")'></div>
        </div>
    </div>
   `)
        }
    }
}
console.log(order);
//添加购物车商品
function addCar(id) {
     console.log(order);
    for (var i = 0; i < order.length; i++) {
        if (order[i].productId == id) {
            if (!order[i].count) {
                order[i].count = 1;
            } else {
                order[i].count += 1;
            }
        }
    }
    computer();
}

//减去购物车的商品
function reduceCar(id) {
    for (var i = 0; i < order.length; i++) {
        if (order[i].productId == id) {
            if (order[i].count == 1) {
                order[i].count = '';
            } else if (order[i].count) {
                order[i].count -= 1;
            } else {
                return
            }
        }
    }
    computer();
}

//计算总值
function computer() {
    allCount = 0;
    totalPrice = 0;
    for (var i = 0; i < order.length; i++) {
        if (order[i].count) {
            allCount = order[i].count + allCount;
            totalPrice += (order[i].count * order[i].productPrice * 100) / 100;
        }
    }
    total = totalPrice;
    footerNumber();
    bottomCar();
    ordernumber();
    savedata();
}

//保存数据
function savedata() {
    order = JSON.stringify(order);
    localStorage.setItem('order', order);
    order = JSON.parse(order);
    localStorage.setItem('allCount', allCount);
    localStorage.setItem('total', total);
}

//恢复正常页面
function toNormal() {
    $('.bottomCar').attr('style', 'display:none');
    $('.screen').attr('style', 'display:none');
}

//是否删除的弹出框
function oderAlertBox() {
    $('.deleteScreen').attr('style', '');

}

//取消弹框
function cancel() {
    $('.deleteScreen').attr('style', 'display:none');
}

//清空所选
function deleteOrder() {
    for (var i = 0; i < order.length; i++) {
        if (order[i].count) {
            order[i].count = '';
        }
    }
    savedata();
    bottomCar();
    // getGoods();
    computer();
    cancel();
    toNormal();
}

//跳转到search页面
function toSearch() {
    location.href = 'search.html'
}

//跳转到details页面
function toDetails(e) {
    localStorage.setItem('id', e);
    location.href = 'details.html'
}

//语言转换
function language() {
    $('.lan .box').attr('style', '')
    $('.lan .imagelanguage').attr('style','display:none')
}

//语言转换
function China() {
    $("#i18n").find("option[value ='zh-CN']").attr("selected", "selected");
    $('.china').trigger('change');
    $('.lan .box').attr('style', ' display:none');
}

function English() {
    $("#i18n").find("option[value ='en']").attr("selected", "selected");
    $('.English').trigger('change');
    $('.lan .box').attr('style', ' display:none');
}

function Russian() {
    $("#i18n").find("option[value ='zh-TW']").attr("selected", "selected");
    $('.Russian').trigger('change');
    $('.lan .box').attr('style', ' display:none');
}
